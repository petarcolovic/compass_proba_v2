<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>The 4C Culture Compass™ by Recrewty</title>
  <style>
    :root{
      --bg:#ffffff;
      --card:#f8f9fa;
      --muted:#6c757d;
      --text:#333333;
      --accent:#38B000;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
      line-height:1.5;
    }
    .wrap{max-width:1200px;margin:auto;padding:24px}
    header{
      display:flex;
      align-items:center;
      gap:12px;
      margin:16px 0 24px;
    }
    header img{height:40px}
    h1{font-size:26px;margin:0}
    .card{
      background:var(--card);
      border:1px solid rgba(0,0,0,.06);
      border-radius:16px;
      box-shadow:0 10px 30px rgba(0,0,0,.1);
    }
    .intro{padding:16px 20px;margin-bottom:16px}
    .q{padding:16px 20px;border-top:1px solid rgba(0,0,0,.06);}
    .q:first-child{border-top:none}
    .q h3{font-size:16px;margin:0 0 12px}
    .scale{display:flex;gap:10px;flex-wrap:wrap}
    .scale label {
      display:flex;align-items:center;gap:8px;
      background:#ffffff;border:2px solid var(--accent);
      color:#333;padding:8px 12px;border-radius:12px;
      cursor:pointer;transition:all 0.2s ease;
    }
    .scale label:hover { background:var(--accent); color:#ffffff; }
    .scale input { accent-color:var(--accent); }
    .actions{display:flex;gap:12px;justify-content:flex-end;padding:14px 20px;border-top:1px solid rgba(0,0,0,.06)}
    button{background:var(--accent);border:none;color:#fff;padding:10px 16px;border-radius:12px;font-weight:600;cursor:pointer}
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr;gap:20px}
    @media (min-width: 980px){ .grid{grid-template-columns:1fr 1fr} }
    .result{padding:16px 20px;text-align:center}
    .best-card{padding:16px 20px;border-top:1px solid rgba(0,0,0,.06);text-align:left}
    .best-card h2{margin:0 0 6px}
    a{color:#38B000}
    .small{font-size:12px}
    .dim-desc{margin:12px 0;font-size:14px;line-height:1.4;text-align:left}
    .legend{margin-top:10px;font-size:13px}
    .legend span{margin:0 10px}
    .compass-bg{position:relative;display:inline-block}
    .compass-bg img{width:400px;height:400px;display:block}
    .compass-bg canvas{position:absolute;left:0;top:0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <a href="https://recrewty.com" target="_blank" rel="noopener">
        <img src="recrewty-logo-white.png" alt="Recrewty logo"/>
      </a>
      <h1>The 4C Culture Compass™ by Recrewty</h1>
    </header>

    <div class="grid">
      <!-- Leva strana: pitanja -->
      <form id="quiz" class="card">
        <div class="intro">
          <p class="muted">Responses for each statement from 1 (do not agree at all) to 5 (completely agree).</p>
        </div>
        <div id="questions"></div>
        <div class="actions">
          <button type="submit">Pošalji</button>
          <button type="button" id="resetBtn" class="muted" style="background:transparent;color:var(--text);border:1px solid rgba(0,0,0,.12)">Poništi</button>
        </div>
      </form>

      <!-- Desna strana: rezultati -->
      <section id="output" class="card" aria-live="polite">
        <div class="result">
          <div class="compass-bg">
            <img src="compass.svg" alt="Compass background"/>
            <canvas id="compassCanvas" width="400" height="400"></canvas>
          </div>
          <div id="legend"></div>
        </div>
        <div id="summary" class="best-card"></div>
        <div id="details"></div>
      </section>
    </div>
  </div>

  <script>
    let ITEMS = [];
    let FIGURES = [];

    // Učitaj pitanja i ličnosti iz JSON fajlova
    async function loadData(){
      const itemsRes = await fetch("items.json");
      ITEMS = await itemsRes.json();
      const figuresRes = await fetch("figures.json");
      FIGURES = await figuresRes.json();
      renderQuestions();
    }

    const DIMS_INFO = {
      "C1": {"name":"Clarity & Compliance vs Agility","high":"Structured Culture - Emphasizes rules, consistency, SOPs. Predictable, process-driven, ideal for scaling operations.","low":"Agile Culture - Values flexibility, improvisation, and informal processes. Good for startups, creative teams, or fast pivots."},
      "C2": {"name":"Competitive Achievement","high":"Performance-Driven Culture - Values competition, ambition, and personal wins. Ideal for sales, finance, high-stakes roles.","low":"Empathetic Culture - Focused on emotional intelligence, harmony, and consensus. Ideal for care-based sectors or internal-facing roles."},
      "C3": {"name":"Collective Loyalty","high":"Team-First Culture - Prioritizes group harmony, shared credit, and loyalty. Strong cohesion and retention.","low":"Individualist Culture - Encourages autonomy, self-expression, and personal goals. Energizing but can reduce cohesion."},
      "C4": {"name":"Commitment to Growth","high":"Growth-Oriented Culture - Values planning, long-term thinking, perseverance, and saving resources for the future.","low":"Present-Oriented Culture - Optimized for short-term gains, flexibility, and immediate feedback loops. Can be highly reactive."}
    };

    // Norme (skraćeni primeri, dodaj sve koje već koristiš)
    const NORMS = {
      "C1": {"10":6.5,"11":15.1,"12":22.7,"13":28.0,"14":32.4,"15":37.2,"16":42.9,"17":47.9,"18":52.6,"19":57.9,"20":63.5,"21":69.6,"22":75.4,"23":81.4,"24":88.1,"25":100.0},
      "C2": {"7":8.0,"8":15.2,"9":21.3,"10":26.0,"11":30.2,"12":34.8,"13":40.0,"14":44.6,"15":48.5,"16":52.5,"17":56.4,"18":60.0,"19":63.8,"20":67.5,"21":71.4,"22":76.1,"23":80.9,"24":85.7,"25":90.4,"26":95.2,"27":100.0},
      "C3": {"7":5.7,"8":14.5,"9":20.8,"10":25.0,"11":27.8,"12":30.9,"13":33.8,"14":36.5,"15":40.1,"16":44.0,"17":48.1,"18":52.7,"19":56.5,"20":59.1,"21":62.3,"22":66.2,"23":69.6,"24":73.0,"25":76.2,"26":79.5,"27":83.3,"28":87.1,"29":91.8,"30":100.0},
      "C4": {"12":8.6,"13":17.1,"14":24.2,"15":30.3,"16":36.3,"17":42.5,"18":48.8,"19":55.2,"20":61.7,"21":68.3,"22":74.8,"23":81.3,"24":88.7,"25":100.0}
    };

    const qWrap = document.getElementById('questions');
    function renderQuestions(){
      qWrap.innerHTML = '';
      ITEMS.forEach(q=>{
        const div=document.createElement('div');
        div.className='q';
        div.innerHTML=`
          <h3>${q.id}. ${q.text}</h3>
          <div class="scale">
            ${[1,2,3,4,5].map(v=>`
              <label>
                <input type="radio" name="q_${q.id}" value="${v}" required /> ${v}
              </label>`).join('')}
          </div>
          <div class="small muted">Scale: 1 = not at all • 5 = completely</div>`;
        qWrap.appendChild(div);
      });
    }

    function computeRawScores(form){
      const sums={};
      ITEMS.forEach(q=>{sums[q.dim]=(sums[q.dim]||0)+Number(form.get(`q_${q.id}`)||0);});
      return sums;
    }

    function normLookup(dim, raw){
      const table=NORMS[dim];
      if(!table) return 0;
      let exact=table[String(raw)];
      if(exact!==undefined) return exact;
      const keys=Object.keys(table).map(k=>Number(k)).sort((a,b)=>a-b);
      if(keys.length===0) return 0;
      if(raw<=keys[0]) return table[String(keys[0])];
      if(raw>=keys[keys.length-1]) return table[String(keys[keys.length-1])];
      let i=0; while(i<keys.length && keys[i]<raw) i++;
      const k2=keys[i],k1=keys[i-1];
      const v1=table[String(k1)],v2=table[String(k2)];
      const t=(raw-k1)/(k2-k1);
      return v1+t*(v2-v1);
    }

    // Koenova mera (Pearson korelacija)
    function profileSimilarity(user, fig){
      const dims=["C1","C2","C3","C4"];
      const u=dims.map(d=>user[d]||0);
      const f=dims.map(d=>fig[d]||0);
      const meanU=u.reduce((a,b)=>a+b,0)/u.length;
      const meanF=f.reduce((a,b)=>a+b,0)/f.length;
      let num=0,denU=0,denF=0;
      for(let i=0;i<dims.length;i++){
        num+=(u[i]-meanU)*(f[i]-meanF);
        denU+=(u[i]-meanU)**2;
        denF+=(f[i]-meanF)**2;
      }
      return num/Math.sqrt(denU*denF);
    }

    function drawCompass(user,figure){
      const canvas=document.getElementById('compassCanvas');
      const ctx=canvas.getContext('2d');
      ctx.clearRect(0,0,canvas.width,canvas.height);

      const size=canvas.width;
      const radius=size*0.36;
      const centerX=size/2,centerY=size/2;
      const dims=["C1","C2","C3","C4"];
      const angles=[-Math.PI/2,0,Math.PI/2,Math.PI];

      function drawPoly(obj,color){
        ctx.beginPath();
        dims.forEach((dim,i)=>{
          const val=obj[dim]||0;
          const r=(val/100)*radius;
          const x=centerX+r*Math.cos(angles[i]);
          const y=centerY+r*Math.sin(angles[i]);
          if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        });
        ctx.closePath();
        ctx.fillStyle=color.replace('1)','0.3)');
        ctx.fill();
        ctx.strokeStyle=color;
        ctx.lineWidth=2;
        ctx.stroke();
      }

      drawPoly(user,'rgba(56,176,0,1)');
      drawPoly(figure,'rgba(255,110,110,1)');
    }

    const form=document.getElementById('quiz');
    const legendDiv=document.getElementById('legend');
    const summaryDiv=document.getElementById('summary');
    const detailsDiv=document.getElementById('details');

    form.addEventListener('submit',async e=>{
      e.preventDefault();
      const data=new FormData(form);
      const raw=computeRawScores(data);
      const dims=["C1","C2","C3","C4"];
      const normed={};
      dims.forEach(d=>normed[d]=Number(normLookup(d,raw[d]||0).toFixed(2)));

      let best=null,worst=null,bestSim=-Infinity,worstSim=Infinity;
      FIGURES.forEach(f=>{
        const sim=profileSimilarity(normed,f.profile);
        if(sim>bestSim){bestSim=sim;best=f;}
        if(sim<worstSim){worstSim=sim;worst=f;}
      });

      drawCompass(normed,best.profile);

      legendDiv.innerHTML='<span style="color:#38B000">■ Your profile</span><span style="color:#ff6e6e">■ '+best.name+'</span>';

      summaryDiv.innerHTML=`
        <h2>Najsličniji si: ${best.name}</h2>
        <p>${best.description}</p>
        <p><strong>Sličnost (Koen):</strong> ${bestSim.toFixed(2)}</p>
        ${best.wiki?`<p><a href="${best.wiki}" target="_blank">Pročitaj više →</a></p>`:""}
        <h3>Najmanje sličan si: ${worst.name}</h3>
        <p>${worst.description}</p>
        <p><strong>Sličnost (Koen):</strong> ${worstSim.toFixed(2)}</p>
      `;

      detailsDiv.innerHTML="";
      dims.forEach(d=>{
        detailsDiv.innerHTML+=`<div class="dim-desc"><strong>${d} - ${DIMS_INFO[d].name}</strong>: ${normed[d]}
          <div><em>Visok skor:</em> ${DIMS_INFO[d].high}</div>
          <div><em>Nizak skor:</em> ${DIMS_INFO[d].low}</div>
        </div>`;
      });

      window.scrollTo({top:0,behavior:'smooth'});
    });

    document.getElementById('resetBtn').addEventListener('click',()=>{
      form.reset();
      const ctx=document.getElementById('compassCanvas').getContext('2d');
      ctx.clearRect(0,0,400,400);
      legendDiv.innerHTML="";
      summaryDiv.innerHTML="";
      detailsDiv.innerHTML='<p class="muted small">Nakon slanja testa, ovde će biti prikazan kompas dijagram i rezultati.</p>';
      window.scrollTo({top:0,behavior:'smooth'});
    });

    loadData();
  </script>
</body>
</html>
